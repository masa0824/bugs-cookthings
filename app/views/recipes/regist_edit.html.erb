<h1>登録レシピ編集画面</h1>

<% if !@recipeTemplate.nil? %>
<ul>
<% @recipeTemplate.errors.full_messages.each do |message| %>
  <li><%= message %></li>
<% end %>
</ul>
<% end %>

<% if flash[:success] %>
<%= flash.now[:success] %>
<% end %>
<% if flash.now[:danger] %>
<%= flash.now[:danger] %>
<% end %>

<div id="recipe-edit">
  <div class="grid">
    <div class="card">
      <% if @recipeTemplate.recipe_template_image.persisted? %>
        <%= cl_image_tag @recipeTemplate.recipe_template_image.key, :quality=>"auto", :fetch_format=>:auto, :class => 'recipe-image', :id => 'DISP_GAZOU' %>
      <% else %>
        <%= image_tag 'sample_xd_new_add_recipe.png', :class => 'recipe-image', :id => 'DISP_GAZOU'  %>
      <% end %>
      <%= form_for @recipeTemplate, url:regist_edit_recipe_path(@recipeTemplate) do |r| %>
        <table id="recipe-table">


          <tr>
            <th>レシピ画像</th>
            <% if @user_total_capacity < @user_limit_info['USER_LIMIT_CAPACITY']*1024*1024 %>
            <td>
              <%= r.file_field :recipe_template_image, :id => 'GAZOU' %><br />
              <%= link_to "画像削除", image_recipe_delete_path(@recipeTemplate, target: 'recipe_template_image'), method: :delete, data: {confirm: '削除しますか？'} %>
            </td>
            <% else %>
              <td>利用容量を超えてます。既存の画像を削除して下さい。</td>
            <% end %>
          </tr>



          <tr>
            <th>レシピ名</th>
            <td><%= r.text_field :recipe_name %></td>
          </tr>
        </table>

        ------------材料------------
        <table id="food-stuff-table">
          <%= r.fields_for :food_stuff_templates do |food|%>
            <%= render "food_stuff_template_fields", f: food %>
          <% end %>
        </table>
        <div class="addBtn"><%= link_to_add_fields "追加", r, :food_stuff_templates %></div>
        
        <%= r.submit "変更", :class => 'btn finish-btn'%>
      <% end %>
    </div>
  </div>
</div>

<%= javascript_pack_tag 'regist_recipe', 'data-turbolinks-track': 'reload' %>